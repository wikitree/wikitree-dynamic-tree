# Bio Check
Code to check a WikiTree biography

## Shared Code
The following are **identical** classes found in the Bio Check app, in the 
WikiTree Browser Extension, and in the WikiTree Dynamic Tree. Please do not
modify these classes to introduce items that are not available in those
contexts.
* Biography.js
* BioCheckPerson.js
* SourceRules.js
The Bio Check app and WikiTree Dynamic Tree make use of
* BioCheckTemplateManager

Example use:
```
import { BioCheckTemplateManager } from "./BioCheckTemplateManager";
import { theSourceRules } from "./SourceRules.js";
import { BioCheckPerson } from "./BioCheckPerson.js";
import { Biography } from "./Biography.js";

  // initialization - just once
  let bioCheckTemplateManager = new BioCheckTemplateManager();
  bioCheckTemplateManager.load();

  // For each person. Get the bio text and dates to test
  let thePerson = new BioCheckPerson();
  let canUseThis = thePerson.canUse(profileObj, openOnly, ignorePre1500, userId);
  let biography = new Biography(theSourceRules);
  biography.parse(bioString, thePerson, searchString);
  let isValid = biography.validate(); 

  // now report from biography (use getters) as desired or just the boolean return 
  // you might want to report any biography that is not valid from the validate()
  // method as well as any any biography that hasStyleIssues()
```
## API 
<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

*   [BioCheckPerson][1]
*   [BioCheckTemplateManager][2]
*   [Biography][3]
*   [dnaInvaldSourceCount][4]
*   [SourceRules][5]

## BioCheckPerson

Contains information about a WikiTree Profile.
Could be a profile obtained via the API in the app
or could be a profile in the WikiTree Browser Extension.
Only contains a subset of the complete set of data available.
Expects the profile to contain the following fields from the API:
Id,Name,IsLiving,Privacy,Manager,IsMember,
BirthDate,DeathDate,BirthDateDecade,DeathDateDecade,
FirstName,RealName,LastNameCurrent,LastNameAtBirth,Mother,Father,DataStatus,Bio

### canUse

Build person from WikiTree API profile object
and determine if it can be used to check sources and style
This method is used from an app, either on app server or tree tools

#### Parameters

*   `profileObj` **[Object][6]** containing the profile as returned from WikiTree APIs
*   `mustBeOpen` **[Boolean][7]** true if profile must not have a manager
*   `mustBeOrphan` &#x20;
*   `ignorePre1500` **[Boolean][7]** true to ignore Pre1500 profiles
*   `userId` **[String][8]** wikiTreeId of the person running the app

Returns **[Boolean][7]** true if this person can be checked

### hasBio

Does this person have a bio

Returns **[Boolean][7]** true if person has bio

### getBio

Get bio string for this person

Returns **[String][8]** bio string

### clearBio

Clear bio for this person
to allow for garbage collection

### getWikiTreeId

Get wikiTreeId for the person

Returns **[String][8]** wikiTreeId (e.g., Doe-100)

### getProfileId

Get profileId for the person

Returns **[String][8]** profileId (e.g., 12345678)

### getReportName

Get name to report

Returns **[String][8]** string with first and last name

### getManagerId

Get manager Id for the person

Returns **[String][8]** manager Id

### isMember

Is profile for a member

Returns **[Boolean][7]** true if profile for a member

### isOrphan

Is profile an orphan

Returns **[Boolean][7]** true if profile is an orphan

### getPrivacy

Get the privacy

Returns **[Number][9]** numeric privacy level

### getPrivacyString

Get the privacy as a string to be displayed to the user

Returns **[String][8]** privacy string (i.e., the color)

### isUncheckedDueToPrivacy

Was profile not checked due to privacy

Returns **[Boolean][7]** true if profile could not be checked due to privacy

### isUncheckedDueToDate

Was profile not checked due to date

Returns **[Boolean][7]** true if profile could not be checked due to date

### build

Initalize person for browser extension.
This method should only be used from the Browser Extension
Uses fields from the web page including mBirthDate, mDeathDate,
mStatusFather, mStatusMother

### isPre1500

Is the person before 1500

Returns **[Boolean][7]** true if either birth or death date before 1500

### isPre1700

Is the person before 1700

Returns **[Boolean][7]** true if either birth or death date before 1700

### isTooOldToRemember

Is the person born > 150 years ago or died > 100 years ago

Returns **[Boolean][7]** true if born > 150 years ago or died > 100 years ago

### isUndated

Does the profile lack dates

Returns **[Boolean][7]** true if profile has neither birth nor death date

### getBirthDate

Get birth date

Returns **[Date][10]** birth date

### getDeathDate

Get death date

Returns **[Date][10]** death date

### getReportDate

Convert date to a display format

#### Parameters

*   `isBirth` &#x20;
*   `true` **[Boolean][7]** to get birth date, else death date

Returns **[String][8]** string in the form yyyy mon dd

## BioCheckTemplateManager

BioCheck Template Manager

### load

Load the template data from WikiTree Plus.
use this method to wait for the load to complete
Send the templates into theSourceRules, which is a singleton.
This only needs to be done once, at initialization.

This can take some time. You can instead use loadPrep to get
a promise and then await loadTemplates using that promise if
there is other initialization to be performed.

*   Throws **any** error getting response

### loadPrep

Send request to load templates from WT+

*   Throws **any** error getting response

Returns **any** promise for use with loadTemplates

### loadTemplates

load Templates - wait for load to complete

#### Parameters

*   `p`  promise returned from loadPrep

<!---->

*   Throws **any** error getting response

## Biography

Parse and validate a WikiTree biography.
Gathers information about style and the parts needed to validate,
along with information about the bio. Provides methods to parse and validate.

### Parameters

*   `theSourceRules`  {SourceRules} source rules for validating sources

### applyPre1700ToAll

Treat all profiles as Pre-1700

### parse

Parse contents of the bio.
After using this, the contents can be validated.
Information about the biography style can be accessed via get methods.

#### Parameters

*   `inStr` **[String][8]** the bio string. This contains the bio as returned
    by the WikiTree API in Wiki format for the profile. Alternately, it can
    be contents obtained from the Edit or Add person pages.
*   `thePerson` **[BioCheckPerson][1]** person to check
*   `bioSearchString` **[String][8]** search string to search for in bio

### validate

Validate contents of bio

Returns **[Boolean][7]** true if profile looks good, else false.
Returns false a profile that appears unsourced (is ?), a profile with an empty bio, a profile with no dates,
or a profile that has an Unsourced Research Notes Box or is in an Unsourced category.

### validateSourcesStr

Validate using just a string of sources. This is typically
used when adding a new person in basic mode.

#### Parameters

*   `sourcesStr` **[String][8]** string containing sources
*   `thePerson`  {BioCheckPerson} person to check

Returns **[Boolean][7]** true if sources found.

### isEmpty

is bio empty

Returns **[Boolean][7]** true if bio empty

### hasCategories

does bio have categories

Returns **[Boolean][7]** true if bio has categories

### isMarkedUnsourced

does bio have Unsourced template or category

Returns **[Boolean][7]** true if bio has Unsourced template or category

### isUndated

is bio undated

Returns **[Boolean][7]** true if bio has neither birth nor death date

### getTotalBioLines

get total number of lines in bio

Returns **[Number][9]** total number of bio lines

### getInlineRefCount

get number of inline ref

Returns **[Number][9]** number of inline ref

### getPossibleSourcesLineCount

get number of lines that might contain sources

Returns **[Number][9]** number of lines that might contain sources

### hasNonCategoryTextBeforeBiographyHeading

does bio have non category text before biography heading

Returns **[Boolean][7]** true if bio has non category text before bio heading

### hasStyleIssues

does bio have style issues

Returns **[Boolean][7]** true if bio has style issues

### hasEndlessComment

does bio have endless comment

Returns **[Boolean][7]** true if bio has endless comment

### isMissingBiographyHeading

is bio missing biography heading

Returns **[Boolean][7]** true if bio is missing biography heading

### hasHeadingWithNoLinesFollowing

does bio have biography heading with no lines following

Returns **[Boolean][7]** true if bio has biography heading with no lines following

### hasMultipleBioHeadings

does bio have multiple biography headings

Returns **[Boolean][7]** true if bio has multiple biography headings

### hasRefWithoutEnd

does bio have ref with ending ref

Returns **[Boolean][7]** true if bio haref with ending refs

### hasSpanWithoutEndingSpan

does bio have span without ending span

Returns **[Boolean][7]** true if bio has span without ending span

### isMissingSourcesHeading

is bio missing sources heading

Returns **[Boolean][7]** true if bio is missing sources heading

### hasMultipleSourceHeadings

does bio have multiple sources headings

Returns **[Boolean][7]** true if bio has multiple sources headings

### getMisplacedLineCount

how many lines are between Sources and references

Returns **[Number][9]** number of lines between sources and references

### isMissingReferencesTag

is bio missing the references tag

Returns **[Boolean][7]** true if is missing the references tag

### hasMultipleReferencesTags

does bio have multiple references tags

Returns **[Boolean][7]** true if bio has multiple references tags

### hasRefAfterReferences

does bio have ref after references

Returns **[Boolean][7]** true if bio has ref after references

### hasAcknowledgementsBeforeSources

does bio have acknowledgements before sources

Returns **[Boolean][7]** true if bio has acknowledgements before sources

### hasSectionAfterAdvanceDirective

does bio have section after advance directive

Returns **[Boolean][7]** true if bio has section heading after advance directive

### hasUnknownSection

does bio have unknown section headings

Returns **[Boolean][7]** true if bio has unknown section headings

### hasPaternalDnaConf

does bio have paternal Dna confirmation

Returns **[Boolean][7]** true if bio has paternal Dna confirmation

### hasMaternalDnaConf

does bio have maternal Dna confirmation

Returns **[Boolean][7]** true if bio has maternal Dna confirmation

### getSectionMessages

/\*\*
Return messages for reporting

Returns **[Array][11]** sectionMessages\[]

### getStyleMessages

Return messages for reporting

Returns **[Array][11]** styleMessages\[]

### getDnaSourceList

Return DNA Confirmation source list
the list is an array of dnaSource, each consisting of
dnaSourceValid: false,
dnaSourceReason: "",
dnaSourceText: "",

### hasSearchString

does bio have search string

Returns **[Boolean][7]** true if bio has the searchString
that was supplied to the parse() method

### hasSources

does bio appear to have sources

Returns **[Boolean][7]** true if bio appears to have sources

### getInvalidSources

get invalid sources found for profile

Returns **[Array][11]** array of String of invalid source lines

### getInvalidDnaSources

get invalid DNA sources found for profile

Returns **[Array][11]** array of String of invalid source lines
for reporting

### getValidSources

get valid sources found for profile

Returns **[Array][11]** array of String of valid source lines

## dnaInvaldSourceCount

Return invalid DNA Source list (for reporting)

## SourceRules

Rules for identifying sources in a biography that are not valid.
This class is intended to be a singleton and immutable.
Access this class using theSourceRules.
The SourceRules are used to check a biography. The methods do not need to
be explictly used, but are available to test strings against the rules if desired.
They could be used, for example, to test for various headings in multiple languages.
All tests assume that the string to test has been converted to lowercase.

### isBiographyHeading

Determine if a line is a valid biography heading

#### Parameters

*   `line` **[String][8]** to test

Returns **[Boolean][7]** true if bio heading else false

### isResearchNotesHeading

Determine if a line is a valid research notes heading

#### Parameters

*   `line` **[String][8]** to test

Returns **[Boolean][7]** true if research notes heading else false

### isSourcesHeading

Determine if a line is a valid sources heading

#### Parameters

*   `line` **[String][8]** to test

Returns **[Boolean][7]** true if sources heading else false

### isAckHeading

Determine if a line is a valid acknowledgements heading

#### Parameters

*   `line` **[String][8]** to test

Returns **[Boolean][7]** true if acknowledgements heading else false

### isAdvanceDirective

Determine if a line is a valid advance directive heading

#### Parameters

*   `line` **[String][8]** to test

Returns **[Boolean][7]** true if advance directive heading else false

### hasDnaTestCompany

Determine if a line contains a DNA testing company

#### Parameters

*   `line` **[String][8]** to test

Returns **[Boolean][7]** true if a DNA testing company

### hasCommonDnaTestCompany

Determine if a line has a common DNA testing company

#### Parameters

*   `line` **[String][8]** to test

Returns **[Boolean][7]** true if a common DNA testing company

### isDnaSourceIdentifier

Determine if a line is something specifying DNA source

#### Parameters

*   `line` **[String][8]** to test

Returns **[Boolean][7]** true if something specifying a DNA source

### isResearchNoteBox

Determine if a line is a valid Research Note Box
assumes the leading {{ removed and line is lower case

#### Parameters

*   `line` **[String][8]** to test

Returns **[Boolean][7]** true if research notes box else false

### getResearchNoteBoxStatus

Return status value for Research Note Box
assumes the leading {{ removed and line is lower case

#### Parameters

*   `line` **[String][8]** to test

Returns **[String][8]** status value or blank if not a research notes box

### isProjectBox

Determine if a line is a valid Project Box
assumes the leading {{ removed and line is lower case

#### Parameters

*   `line` **[String][8]** to test

Returns **[Boolean][7]** true if research notes box else false

### isNavBox

Determine if a line is a valid Nav Box
assumes the leading {{ removed and line is lower case

#### Parameters

*   `line` **[String][8]** to test

Returns **[Boolean][7]** true if nav box else false

### isSticker

Determine if a line is a valid Sticker
assumes the leading {{ removed and line is lower case

#### Parameters

*   `line` **[String][8]** to test

Returns **[Boolean][7]** true if sticker else false

### isRecommendedTag

Determine if a line starts with an HTML tag
that is recommended for use on WikiTree.
Typically used for a line that starts with <

#### Parameters

*   `line` **[String][8]** to test

Returns **[Boolean][7]** true if recommended else false

### isCensus

Determine if a line is a census line

#### Parameters

*   `line` **[String][8]** to test

Returns **[Boolean][7]** true if census line else false

### hasCensusString

Determine if a line contains a census string

#### Parameters

*   `line` **[String][8]** the line

Returns **any** census string if line contains census string

### isInvalidSource

Determine if line by itself is an invalid source

#### Parameters

*   `line` **[String][8]** input source string

Returns **[Boolean][7]** true if invalid source else false

### removeInvalidSourcePart

Remove a string that by itself on a line is not a valid source

#### Parameters

*   `line` **[String][8]** the line to check

Returns **[String][8]** line with any invalid sources removed

### removeInvalidSourcePartTooOld

Remove a string that by itself on a line is not a valid source
for too old to remember

#### Parameters

*   `line` **[String][8]** the line to check

Returns **[String][8]** line with any invalid sources removed

### removeInvalidSourcePartPre1700

Remove a string that by itself on a line is not a valid source Pre1700

#### Parameters

*   `line` **[String][8]** the line to check

Returns **[String][8]** line with any invalid sources removed

### isInvalidPartialSource

Determine if line is an invalid source when found anywhere on a line

#### Parameters

*   `line` **[String][8]** input source string

Returns **[Boolean][7]** true if found on invalid partial source list, else false

### isInvalidPartialSourceTooOld

Determine if line is an invalid source when found anywhere on a line
when the person is too old to remember

#### Parameters

*   `line` **[String][8]** input source string

Returns **[Boolean][7]** true if found on too old partial source list, else false

### isInvalidPartialSourcePre1700

Determine if line is an invalid source when found anywhere on a line
and the person is Pre1700

#### Parameters

*   `line` **[String][8]** input source string

Returns **[Boolean][7]** true if found on pre1700 partial source list, else false

### isValidPartialSourcePre1700

Determine if line is a valid source if found anywhere on a line
and the person is Pre1700

#### Parameters

*   `line` **[String][8]** input source string

Returns **[Boolean][7]** true if found on pre1700 valid partial source list, else false

### isInvalidStartPartialSource

Determine if line starts with something on the invalid partial source list

#### Parameters

*   `line` **[String][8]** input source string

Returns **[Boolean][7]** true if starts with invalid source, else false

### isInvalidSourceTooOld

Determine if line by itself is an invalid source for profile too old to
remember

#### Parameters

*   `line` **[String][8]** input source string

Returns **[Boolean][7]** true if invalid source else false

### isInvalidSourcePre1700

Determine if line by itself is an invalid source for Pre1700

#### Parameters

*   `line` **[String][8]** input source string

Returns **[Boolean][7]** true if invalid source else false

[1]: #biocheckperson

[2]: #biochecktemplatemanager

[3]: #biography

[4]: #dnainvaldsourcecount

[5]: #sourcerules

[6]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[7]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean

[8]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[9]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number

[10]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Date

[11]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array
